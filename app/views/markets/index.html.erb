<%#page that map appears%>

<p id="notice"><%= notice %></p>

<h1>Listing Markets</h1>

<div id="map"></div>

<form id='map-form'>
  <input type='text' name='zip' placeholder='ZIP Code'>
  <input type='submit' value='Search'>
</form>

<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Address</th>
      <th>Zip</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @markets.each do |market| %>
      <tr>
        <td><%= market.name %></td>
        <td><%= market.address %></td>
        <td><%= market.zip %></td>
        <td><%= link_to 'Show', market %></td>
        <td><%= link_to 'Edit', edit_market_path(market) %></td>
        <td><%= link_to 'Destroy', market, method: :delete, data: { confirm: 'Are you sure?' } %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<br>

<%= link_to 'New Market', new_market_path %>

<script>

$(document).ready(function(){
  var map = L.map('map').setView([26.128807, -80.14497], 13);

  L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
    attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
    maxZoom: 18,
    id: 'mjesuele.medcme14',
    accessToken: 'pk.eyJ1IjoibWplc3VlbGUiLCJhIjoiYWNlMTk1OTUwMzg4ZjNiODhjZWQwMzY5MWY2NWQwZTUifQ.7g81IuO6O_VQ1RMumb4sRg#3/0.00/0.00'
  }).addTo(map);

  $.ajax({
    dataType: 'json',
    url: '/markets.json',
    success: function(markets) {
      markets.forEach(function(mkt) {
        var coords = [mkt["latitude"], mkt["longitude"]];
        L.marker(coords).addTo(map);
      });
    }
  });
});
</script>
